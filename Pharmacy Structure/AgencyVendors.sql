USE Pharmacy 
go

CREATE TABLE AgencyVendors (
	id int IDENTITY(1,1) PRIMARY KEY,
	Vendor_id int NOT NULL FOREIGN KEY REFERENCES Vendors(Vendor_id),
	Agency_id int NOT NULL FOREIGN KEY REFERENCES Agencies(Agency_id)
)
go

CREATE OR ALTER 
TRIGGER TAgencyVendorValidator
	ON AgencyVendors
	FOR INSERT, UPDATE

AS
SET NOCOUNT ON
 IF EXISTS(SELECT *
				 FROM AgencyVendors
				 GROUP BY Vendor_id, Agency_id
				 HAVING COUNT(*)>1)
	ROLLBACK
go


CREATE INDEX IAgency
	ON AgencyVendors(Agency_id)

CREATE INDEX IVendor
	ON AgencyVendors(Vendor_id)
go


INSERT INTO AgencyVendors(Vendor_id, Agency_id)
Values (13, 10),
(41, 11),
(19, 13),
(36, 22),
(23, 56),
(27, 57),
(57, 25),
(4, 29),
(17, 9),
(56, 11),
(1, 40),
(49, 39),
(4, 5),
(23, 26),
(55, 49),
(32, 25),
(28, 48),
(45, 57),
(54, 11),
(25, 51),
(21, 32),
(8, 47),
(35, 59),
(24, 37),
(57, 58),
(27, 31),
(36, 13),
(12, 11),
(19, 38),
(46, 58),
(43, 14),
(35, 35),
(32, 43),
(30, 30),
(38, 45),
(40, 42),
(31, 52),
(15, 24),
(18, 1),
(49, 19),
(44, 50),
(8, 10),
(25, 10),
(24, 40),
(47, 13),
(8, 49),
(57, 45),
(2, 36),
(38, 3),
(27, 13),
(11, 31),
(6, 14),
(5, 20),
(16, 55),
(23, 43),
(26, 52),
(50, 50),
(31, 42),
(24, 36),
(17, 13),
(19, 55),
(29, 4),
(23, 16),
(18, 20),
(13, 11),
(11, 45),
(14, 44),
(24, 54),
(48, 58),
(30, 50),
(51, 10),
(7, 52),
(20, 34),
(2, 28),
(29, 55),
(3, 21),
(38, 18),
(21, 27),
(9, 8),
(35, 30),
(29, 24),
(12, 27),
(53, 24),
(6, 16),
(22, 4),
(9, 9),
(25, 44),
(15, 41),
(38, 2),
(37, 59),
(38, 26),
(46, 14),
(29, 54),
(55, 54),
(5, 14),
(19, 18),
(41, 30),
(17, 30),
(55, 25),
(10, 54),
(10, 20),
(38, 5),
(47, 34),
(6, 17),
(53, 19),
(6, 44),
(25, 54),
(13, 26),
(37, 3),
(4, 6),
(47, 14),
(43, 23),
(53, 8),
(17, 15),
(12, 13),
(16, 57),
(7, 27),
(44, 24),
(20, 4),
(16, 35),
(10, 24),
(41, 50),
(22, 40),
(52, 13),
(37, 55),
(57, 52),
(22, 42),
(5, 50),
(58, 18),
(53, 38),
(16, 4),
(46, 16),
(20, 12),
(52, 3),
(52, 46),
(27, 53),
(46, 8),
(31, 30),
(25, 4),
(9, 34),
(24, 3),
(46, 29),
(20, 5),
(17, 28),
(10, 12),
(48, 22),
(31, 4),
(8, 22),
(55, 53),
(51, 2),
(38, 12),
(25, 3),
(58, 57),
(25, 47),
(49, 6),
(25, 58),
(8, 25),
(58, 30),
(5, 4),
(27, 18),
(54, 34),
(16, 14);